# 报告生成成本计算器

> 基于当前使用的 Perplexity API `sonar-deep-research` 模型计算单篇报告生成成本

## 📊 当前配置参数

### API设置
- **模型**: `sonar-deep-research` (学术级深度研究模型)
- **最大令牌数**: 20,000 tokens
- **温度**: 0.05 (极低温度确保精确性)
- **搜索功能**: 启用 (search_queries: true)
- **搜索范围**: 最近一个月 (search_recency_filter: 'month')

## 💰 成本分析

### Perplexity API 定价结构

根据搜索到的信息，Perplexity API的定价模式包括：

1. **请求费用**: $5.00 / 1000次请求 = $0.005 / 次请求
2. **Token费用**: 根据模型不同，$0.2 - $5.0 / 百万token

### sonar-deep-research 模型估算

由于 `sonar-deep-research` 是高端学术研究模型，估算定价为：
- **Token费用**: ~$2.0 / 百万token (基于类似70B+参数模型)

## 🧮 单篇报告成本计算

### 典型报告Token使用量分析

基于我们的报告配置：

```typescript
// 输入部分
System Prompt: ~800 tokens
User Prompt: ~200 tokens
Stock Data: ~100 tokens
总输入: ~1,100 tokens

// 输出部分 (JSON格式，4个部分)
fundamentalAnalysis: ~3,000 tokens
businessSegments: ~3,000 tokens  
growthCatalysts: ~3,000 tokens
valuationAnalysis: ~3,000 tokens
JSON结构 + HTML: ~1,000 tokens
总输出: ~13,000 tokens

// 搜索增强
Search Query Processing: ~500 tokens
Citations & References: ~1,000 tokens

总计: ~15,600 tokens
```

### 成本计算

```
单篇报告总成本 = 请求费用 + Token费用

1. 请求费用: $0.005

2. Token费用: 
   15,600 tokens × ($2.0 / 1,000,000 tokens) = $0.0312

总成本 = $0.005 + $0.0312 = $0.0362
```

## 📈 成本汇总表

| 项目 | 数量 | 单价 | 成本 |
|------|------|------|------|
| API请求 | 1次 | $0.005/次 | $0.005 |
| 输入Token | ~1,600 | $2.0/百万 | $0.0032 |
| 输出Token | ~13,000 | $2.0/百万 | $0.026 |
| 搜索Token | ~1,500 | $2.0/百万 | $0.003 |
| **总计** | **~16,100 tokens** | | **≈ $0.037** |

## 🎯 成本优化建议

### 当前配置优势
✅ **高质量输出**: 投资银行级报告质量  
✅ **深度研究**: 学术级模型确保准确性  
✅ **实时数据**: 最新一个月的信息搜索  
✅ **成本合理**: 单篇报告仅需 ~$0.04  

### 可能的优化方向
1. **Token优化**: 精简System Prompt (节省 ~10%)
2. **缓存策略**: 对相同股票的重复查询使用缓存
3. **批量处理**: 多股票分析时可节省固定成本

## 📊 规模化成本预估

| 报告数量 | 总成本 | 平均成本 |
|----------|--------|----------|
| 10篇 | $0.37 | $0.037/篇 |
| 100篇 | $3.70 | $0.037/篇 |
| 1000篇 | $37.00 | $0.037/篇 |
| 10000篇 | $370.00 | $0.037/篇 |

## 💡 商业化建议

### 定价策略
考虑到 ~$0.04 的API成本，建议的用户定价：

- **基础版**: $0.99/篇 (25x markup)
- **专业版**: $2.99/篇 (75x markup，包含额外功能)
- **企业版**: $9.99/篇 (250x markup，包含定制化)

### 成本控制
- **用户配额**: 限制每日/月报告生成数量
- **质量分级**: 提供不同质量等级的报告选项
- **批量折扣**: 大量使用客户给予成本优惠

---

**结论**: 当前配置下，单篇高质量投资研究报告的生成成本约为 **$0.037 (约¥0.27)**，成本控制良好，具有良好的商业化空间。
